<section class="additional-info">
  <h3>{{ _('Dataset Metadata') }}</h3>
    
    {% resource 'ckanext-dcatapit/dcatapit.css' %}

  <table class="table table-striped table-bordered table-condensed">
    <tbody>
		{% block dcatapit_additional_info %}
			{% set schema_fields = h.get_dcatapit_package_schema() %}

			{% for field in schema_fields %}	  

				{% if not field.ignore and not field.ignore_from_info %}

				  	{% if field.element == 'couple' %}

				  		{% set couples = h.couple_to_html(field.couples, pkg_dict)%}

		  		        <tr>
					      <th scope="row" class="dataset-label">{{ field.label }}</th>
				          <td class="dataset-details">
				          	{% if couples %}
					          	{% for couple in couples %}
					          		{{ couple or _('N/D') }} <br/>
					          	{% endfor %}
				          	{% else %}
				          		{{ _('N/D') }}
				          	{% endif %}
				          </td>
					    </tr>

                    {% elif field.element == 'conforms_to' %}
                        {% set conforms_to = h.json_load(pkg_dict[field.name]) %}

		  		        <tr>
					      <th scope="row" class="dataset-label">{{ field.label }}</th>
				          <td class="dataset-details">
                            {% if not conforms_to %}
				          		{{ _('N/D') }}
                            {% else %}
                                {% for std in conforms_to %}
                                <div class="std">
                                    <div class="row">
                                        <div class="span4 std-key">Identifier</div>
                                        <div class="span8 std-value">{{ std.identifier }}</div>
                                    </div>
                                
                                    <div class="row">
                                        <div class="span4 std-key">Title</div>
                                        <div class="span8 std-value">{{ std.title[h.lang()] }}</div>
                                    </div>
                                    <div class="row">
                                        <div class="span4 std-key">Description</div>
                                        <div class="span8 std-value">{{ std.title[h.lang()] }}</div>
                                    </div>

                                    <div class="row odd">
                                        <div class="span12 std-key">Reference documentation</div>
                                    </div>
                                    {% for ref in std['referenceDocumentation'] %}
                                        <div class="row">
                                            <div class="span12 std-value"><a href="{{ ref }}">{{ ref }}</a></div>
                                        </div>
                                    {% endfor %}

                                </div>
                                {% endfor %}
                            {% endif %}
				          </td>
					    </tr>
                    

					{% else %}

						{% if pkg_dict[field.name] %}

							{# -- get_localized_field_value call can be omitted because ckanext-multilang and custom fields localization methods in this plugin do this automatically -- #}
							{#% set field_localized = h.get_vocabulary_items(field.vocabulary_name, pkg_dict[field.name][1:-1].split(",") if ',' in pkg_dict[field.name] else [pkg_dict[field.name]]) if field.type == 'vocabulary' else h.get_localized_field_value(pkg_dict[field.name], pkg_dict['id'])%}
					  		{% set value_field = field_localized or pkg_dict[field.name]%#}

					  		{% set value_field = h.get_vocabulary_items(field.vocabulary_name, pkg_dict[field.name][1:-1].split(",") if ',' in pkg_dict[field.name] else [pkg_dict[field.name]]) if field.type == 'vocabulary' else pkg_dict[field.name]%}

						  	{% if value_field is iterable and value_field is not string %}
							  	<tr>
							      <th scope="row" class="dataset-label">{{ field.label }}</th>
							      <td class="dataset-details">{{ h.list_to_string(value_field, field.format) or field.default or _('N/D') }}</td>
							    </tr>
							{% else %}
						        <tr>
							      <th scope="row" class="dataset-label">{{ field.label }}</th>
								  {% if h.is_url(value_field) %}
						          	<td class="dataset-details">{{ h.link_to(value_field, value_field, rel='', target='_blank') or field.default or _('N/D') }}</td>
						          {% else %}
						         	<td class="dataset-details">{{ h.format(value_field, field.format, field.type) or field.default or _('N/D') }}</td>
						          {% endif %}
							    </tr>
						    {% endif %}

					    {% else %}

					    	<tr>
							    <th scope="row" class="dataset-label">{{ field.label }}</th>
								<td class="dataset-details">{{ field.default or _('N/D') }}</td>
							</tr>		
									    	
					    {% endif %}

				  	{% endif %}

			  	{% endif %}	  

			{% endfor %}

		{% endblock %}
    </tbody>
  </table>
</section>

{% set catalog_title = h.get_pkg_dict_extra(pkg_dict, 'source_catalog_title') %}
{% if catalog_title %}
<section class="additional-info">
  <h3>{{ _('Source Catalog Info') }}</h3>
  <table class="table table-striped table-bordered table-condensed">
    <thead>
      <tr>
        <th scope="col">{{ _('Field') }}</th>
        <th scope="col">{{ _('Value') }}</th>
      </tr>
    </thead>
    <tbody>
          <tr>
            <th scope="row" class="dataset-label">{{ _('Name') }}</th>
            <td class="dataset-details" property="dct:title">{{ catalog_title }}</td>
          </tr>

				  {% set catalog_description = h.get_pkg_dict_extra(pkg_dict, 'source_catalog_description') %}
          {% if catalog_description %}
          <tr>
            <th scope="row" class="dataset-label">{{ _('Description') }}</th>
            <td class="dataset-details" property="dct:title">{{ catalog_description }}</td>
          </tr>
          {% endif %}
					
				  {% set catalog_homepage = h.get_pkg_dict_extra(pkg_dict, 'source_catalog_homepage') %}
          {% if catalog_homepage %}
          <tr>
            <th scope="row" class="dataset-label">{{ _('Homepage') }}</th>
            {% if h.is_url(catalog_homepage) %}
              <td class="dataset-details" property="foaf:homepage">{{ h.link_to(catalog_homepage, catalog_homepage, rel='foaf:homepage', target='_blank') }}</td>
            {% else %}
              <td class="dataset-details" property="foaf:homepage">{{ catalog_homepage }}</td>
            {% endif %}
          </tr>
         {% endif %}

         {% set catalog_modified = h.get_pkg_dict_extra(pkg_dict, 'source_catalog_modified') %}
         {% if catalog_modified %}
          <tr>
            <th scope="row" class="dataset-label">{{ _("Last Updated") }}</th>
            <td class="dataset-details">
                {% snippet 'snippets/local_friendly_datetime.html', datetime_obj=catalog_modified %}
            </td>
          </tr>
        {% endif %}
    </tbody>
  </table>
</section>

{% endif %}	  
